@use "variables";
@use "layout";
@use "print";
@use "navigation";
@use "code";

@use "components/social-share";
@use "components/linked-post";
@use "components/table-of-contents";
@use "components/search";
@use "components/footer";

*, *::before, *::after { box-sizing: border-box; }


.post-header-featured-image {
  width: 100%;
}


.content h1 {
  margin-top: var(--gap-medium);
}

.post-list {
  padding:0;

  h2 {
    margin-top: 0;
    padding-top: 0;
  }
}

.post img {
  max-width: 100%;
  height: auto;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

body {
  font-family: var(--font-body);
  font-size: clamp(16px, 1.1vw + 12px, 18px);
  line-height: 1.6;
}

h1, h2, h3, h4 {
  color: var(--color-text-heading);
  font-family: var(--font-heading);
  font-weight: 600;
  line-height: 1.25;
}

/* For accessibility instead of display:none */
.visually-hidden {
  clip: rect(0 0 0 0);
  clip-path: inset(50%);
  height: 1px;
  overflow: hidden;
  position: absolute;
  white-space: nowrap;
  width: 1px;
}

.menu-items, .post-tags {
  list-style: none;
  display: flex;
  gap: 0.5rem;
}

.post-list {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: var(--gap-medium);
}

#post .post-tags {
  display: inline-block;

  li {
    display: inline;
    margin: 0.15rem;
  }

  .tag-name::before {
    content: "#";
  }
}



/*
  Visually hidden "Skip to content" link for accessibility.
  Hidden off-screen by default, but becomes visible and accessible
  when focused (e.g. via keyboard navigation). This allows keyboard
  and screen reader users to bypass repeated navigation and jump
  directly to the main content.
*/
.skip-link {
  position: absolute;
  left: -9999px;

  &:focus {
    left: 0;
    top: 0;
    padding: .5rem 1rem;
    background: #000;
    color: #fff;
    z-index: 1000;
  }
}

.image-wrapper {
  // CSS custom properties for LQIP (Low Quality Image Placeholder) behavior
  --lqip-blur-amount: 60px;
  --lqip-transition-duration: 0.3s;
  --lqip-bg-color: #f0f0f0;

  overflow: hidden;

  // Low Quality Image Placeholder - blurred initially
  .lqip {
    display: block;
    filter: blur(var(--lqip-blur-amount));
    transition: filter var(--lqip-transition-duration) ease-out;
    background-color: var(--lqip-bg-color);
    overflow: hidden;

    // Remove blur once image is loaded
    &[data-loaded] {
      filter: blur(0);
    }
  }
}

article {
  line-height: 1.6;
  font-size: 1rem;
}




.post-header-divider {
  margin-top: var(--gap-large);
  height: 2px;
  background: color-mix(in srgb, var(--color-border) 80%, transparent);
  border: none;
}

.post-header-excerpt {
  margin-top: var(--gap-large);
  color: var(--color-text-muted);
}

.date-published, .date-modified {
  color: var(--color-text-subtle);
}

/* Better scroll positioning when jumping to headings */
:is(h2,h3,h4)[id]{ scroll-margin-top: 7rem; position:relative; }

//TODO add copy to clipboard functionality
/* The anchor icon */
.header-anchor{
  display:inline-grid;
  place-items:center;
  inline-size: 1.25em;        /* reserve space to avoid layout shift */
  block-size: 1.25em;
  margin-inline-start: .35em; /* logical spacing (RTL-safe) */
  border-radius: .35em;
  color: var(--color-text-subtle);
  text-decoration: none;
  opacity: 0;                 /* default hidden on pointer devices */
  transform: translateY(.1em);/* align to text baseline a bit nicer */
  transition: opacity .18s ease, color .18s ease, box-shadow .18s ease;
  outline: none;
}

/* Icon via mask + currentColor, so it adapts to theme */
.header-anchor::before{
  content: "";
  inline-size: 1em; block-size: 1em;
  background: currentColor;
  -webkit-mask: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'>\
<path d='M7.775 3.275a.75.75 0 0 0 1.06 1.06l1.25-1.25a2 2 0 1 1 2.83 2.83l-2.5 2.5a2 2 0 0 1-2.83 0 .75.75 0 1 0-1.06 1.06 3.5 3.5 0 0 0 4.95 0l2.5-2.5a3.5 3.5 0 1 0-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 0 1 0-2.83l2.5-2.5a2 2 0 0 1 2.83 0 .75.75 0 1 0 1.06-1.06 3.5 3.5 0 0 0-4.95 0l-2.5 2.5a3.5 3.5 0 1 0 4.95 4.95l1.25-1.25a.75.75 0 1 0-1.06-1.06l-1.25 1.25a2 2 0 0 1-2.83 0z'/>\
</svg>") no-repeat center / 100% 100%;
  mask: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M7.775 3.275a.75.75 0 0 0 1.06 1.06l1.25-1.25a2 2 0 1 1 2.83 2.83l-2.5 2.5a2 2 0 0 1-2.83 0 .75.75 0 1 0-1.06 1.06 3.5 3.5 0 0 0 4.95 0l2.5-2.5a3.5 3.5 0 1 0-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 0 1 0-2.83l2.5-2.5a2 2 0 0 1 2.83 0 .75.75 0 1 0 1.06-1.06 3.5 3.5 0 0 0-4.95 0l-2.5 2.5a3.5 3.5 0 1 0 4.95 4.95l1.25-1.25a.75.75 0 1 0-1.06-1.06l-1.25 1.25a2 2 0 0 1-2.83 0z'/></svg>")
  no-repeat center / 100% 100%;
}

/* Reveal on hover/focus; color on interaction */
:is(h2,h3,h4):hover .header-anchor,
.header-anchor:focus-visible{ opacity: 1; color: var(--color-link); }

/* Nice keyboard focus */
.header-anchor:focus-visible{
  box-shadow: 0 0 0 3px color-mix(in oklch, var(--color-link) 35%, transparent);
}

/* Touch devices: always visible (no hover) */
@media (hover: none){ .header-anchor{ opacity: .75; } }

/* Light/dark harmony (optional) */
:root[data-theme="light"] .header-anchor{ color: var(--color-text-subtle); }

/* Applies to headings that have the permalink anchor */
.post h1,
.post h2,
.post h3,
.post h4 {
  position: relative;
  scroll-margin-top: 6rem; /* prevents heading from sitting under the fixed nav */
}

/* The inserted anchor icon */
.post h2 .header-anchor,
.post h3 .header-anchor,
.post h4 .header-anchor {
  position: absolute;
  left: -2.3rem;            /* distance into the left gutter */
  top: 52.5%;
  transform: translateY(-50%);
  opacity: 0;               /* hide by default */
  text-decoration: none;
  color: var(--color-text-muted);
  font-size: 0.9em;
  transition: opacity 0.2s ease, color 0.2s ease;
  padding: 0.2rem;
}

/* Show the icon on hover/focus */
.post h2:hover .header-anchor,
.post h2:focus-within .header-anchor,
.post h3:hover .header-anchor,
.post h3:focus-within .header-anchor,
.post h4:hover .header-anchor,
.post h4:focus-within .header-anchor {
  opacity: 1;
  color: var(--color-link);
}

/* Mobile: always show icon (no hover available) */
//TODO use variable breakpoint
@media (max-width: 600px) {
  .post h2 .header-anchor,
  .post h3 .header-anchor,
  .post h4 .header-anchor {
    opacity: 1;
  }
}




.msg {
  border-width: 1px;
  border-style:solid;
  padding: var(--gap-medium);
  margin: var(--gap-medium) 0;
  border-radius: var(--radius-sm);
}

.msg-warn {
  border-color: var(--color-warning-border);
  background: var(--color-warning-bg);
  color: var(--color-warning);
}

.msg-error {
  border-color: var(--color-error-border);
  background: var(--color-error-bg);
  color: var(--color-error);
}

.msg-success {
  border-color: var(--color-success-border);
  background: var(--color-success-bg);
  color: var(--color-success);
}

.msg-info {
  border-color: var(--color-info-border);
  background: var(--color-info-bg);
  color: var(--color-info);
}

#comments {
  padding-top: var(--gap-large);
  padding-bottom: var(--gap-xlarge);
}


body {
  background-color: var(--color-surface-0);
  color: var(--color-text);
  margin: 0;
}

.footer {
  margin-top: var(--gap-large);
  background-color: var(--color-surface-1);
  border-top: 1px solid var(--color-border);
}

a { color: var(--color-link); }
a:hover { color: var(--color-link-hover); }

// Focus outline
:where(a, button, input, textarea, select, [tabindex]) :focus-visible,
:where(a, button, input, textarea, select, [tabindex]):focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-link) 35%, transparent);
  border-radius: var(--radius-sm);
}

.toc-list {
  li a {
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    max-width: 100%;
    display: block;
  }
}


















.toc {
  margin-top: 1.5rem;
  background: var(--color-surface-1);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  padding-top: 0;
  padding-right: var(--gap-medium);
  padding-left: var(--gap-medium);
  padding-bottom: var(--gap-medium);
  position: sticky;
  top: 6rem;
}




.post blockquote {
  margin: var(--gap-medium) 0;
  padding: 1.2rem 1.6rem;
  border-left: 3px solid var(--color-accent);
  background: color-mix(in srgb, var(--color-surface-2) 85%, black);
  border-radius: var(--radius-sm);
  font-style: italic;
  color: var(--color-text-muted);
  line-height: 1.55;
}

.post-content blockquote > :last-child {
  margin-bottom: 0;
}