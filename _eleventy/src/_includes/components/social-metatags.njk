{#
Social meta tags for Open Graph + Twitter
Handles posts with featuredImage in same folder (./image.jpg)
and generic pages (site-wide defaults).
#}

{% set kind = kind or (date ? 'article' : 'website') %}
{% set pageTitle = title or site.title %}
{% set pageDescription = description or site.description %}
{% set pageUrl = site.url + page.url %}

{# --- Featured image handling --- #}
{% set fm = featuredImage %}
{% if fm %}
{% if fm[0:4] == 'http' %}
{# already absolute URL #}
{% set imageUrl = fm %}
{% elseif fm[0:1] == '/' %}
{# root-relative path like /images/foo.jpg #}
{% set imageUrl = site.url + fm %}
{% else %}
{# relative to post directory (e.g. ./jam.jpg) #}
{% set filename = fm | replace('./', '') %}
{% set imageUrl = site.url + page.url + filename %}
{% endif %}
{% else %}
{# fallback default image #}
{% set imageUrl = site.url + '/images/default-share.png' %}
{% endif %}

<!-- Open Graph -->
<meta property="og:type" content="{{ kind }}">
<meta property="og:title" content="{{ pageTitle }}">
<meta property="og:description" content="{{ pageDescription }}">
<meta property="og:url" content="{{ pageUrl }}">
<meta property="og:image" content="{{ imageUrl }}">
<meta property="og:site_name" content="{{ site.name }}">
<meta property="og:locale" content="en_US">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ pageTitle }}">
<meta name="twitter:description" content="{{ pageDescription }}">
<meta name="twitter:image" content="{{ imageUrl }}">
{% if site.twitter %}
  <meta name="twitter:site" content="{{ site.twitter }}">
  <meta name="twitter:creator" content="{{ site.twitter }}">
{% endif %}

{% if kind == 'article' %}
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "{{ pageTitle | escape }}",
    "description": "{{ pageDescription | escape }}",
    "image": "{{ imageUrl }}",
    "author": {
      "@type": "Person",
      "name": "{{ site.name }}"
    },
    "datePublished": "{{ date | dateToISO }}",
    "url": "{{ pageUrl }}"
  }
</script>
{% endif %}
