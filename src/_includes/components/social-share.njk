{# --- Derived params --- #}
{% set absoluteUrl = site.url + page.url %}
{% set shareUrlParam = absoluteUrl | urlencode %}
{% set shareTitleParam = (title or page.title or site.title) | urlencode %}

<nav class="social-share" aria-label="Share this post">
  <p class="social-share-label">Share this article</p>
  <ul role="list" class="share-list">

    {# Native share (only shown if navigator.share is available) #}
    <li>
      <button type="button"
              class="share-icon share-native"
              id="native-share-button"
              aria-label="Share using your apps"
              hidden>
        {% include "../icons/share.njk" %}
      </button>
    </li>

    {# Copy link (universal fallback) #}
    <li>
      <button type="button"
              class="share-icon share-copy"
              aria-label="Copy link to clipboard"
              data-url="{{ absoluteUrl }}">
        {% include "../icons/copy.njk" %}
      </button>
    </li>

  </ul>
</nav>

<script>
  (function () {
    const nativeBtn = document.getElementById('native-share-button');
    const shareUrl = "{{ absoluteUrl }}";

    // Enable native share if supported
    if (nativeBtn && navigator.share) {
      nativeBtn.hidden = false;

      nativeBtn.addEventListener('click', async () => {
        try {
          await navigator.share({
            title: document.title,
            text: document.querySelector('meta[name="description"]')
              ? document.querySelector('meta[name="description"]').content
              : '',
            url: shareUrl
          });
        } catch (err) {
          // user cancelled or share failed â€” ignore
        }
      });
    }

    // Copy-to-clipboard feedback
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.share-copy');
      if (!btn) return;

      const url = btn.dataset.url || location.href;

      (async () => {
        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(url);
          } else {
            window.prompt('Copy URL of this page:', url);
            return;
          }

          const prev = btn.getAttribute('aria-label') || 'Copy link to clipboard';
          btn.classList.add('copied');
          btn.setAttribute('aria-label', 'Link copied');

          setTimeout(() => {
            btn.classList.remove('copied');
            btn.setAttribute('aria-label', prev);
          }, 2000);
        } catch {
          window.prompt('Copy this URL:', url);
        }
      })();
    });
  })();
</script>
